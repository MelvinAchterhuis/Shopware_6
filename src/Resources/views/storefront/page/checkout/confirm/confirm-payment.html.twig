{% sw_extends '@Storefront/storefront/page/checkout/confirm/confirm-payment.html.twig' %}

{% block page_checkout_confirm_payment_current_image %}

    {% if context.paymentMethod.customFields.buckaroo_key == 'creditcards' %}
        <img src="{{ page.extensions.buckaroo.media_path }}{{ page.extensions.buckaroo.payment_media }}" class="payment-method-image">
    {% elseif context.paymentMethod.media %}
        {% sw_thumbnails 'confirm-payment-current-image-thumbnails' with {
            media: context.paymentMethod.media,
            sizes: {
                'default': '100px'
            },
            attributes: {
                'class': 'payment-method-image',
                'alt': (context.paymentMethod.media.translated.alt ?: context.paymentMethod.translated.name),
                'title': (context.paymentMethod.media.translated.title ?: context.paymentMethod.translated.name)
            }
        } %}
    {% endif %}

{% endblock %}

{% block page_checkout_confirm_payment_current_text %}

    {% if context.paymentMethod.customFields.buckaroo_key == 'ideal' or context.paymentMethod.customFields.buckaroo_key == 'idealprocessing' %}
    <strong>{{ "checkout.confirmCurrentPaymentShipping"|trans }}</strong>
        
        {{ page.extensions.buckaroo.payment_labels[context.paymentMethod.name]?:context.paymentMethod.translated.name }}

        {% if page.extensions.buckaroo.issuers|length > 0 %}
            <div>
                <label><strong>{{ "bkr-ideal.selectBankIssuer"|trans|sw_sanitize }}</strong>*:</label>
                {% for issuer in page.extensions.buckaroo.issuers %}
                    <div class="custom-control custom-radio bank-control">
                        <input type="radio"
                        form="confirmOrderForm"
                        required="required"
                        id="bankMethod{{ issuer.code }}"
                        name="bankMethodId"
                        value="{{ issuer.code }}"
                        class="custom-control-input bank-method-input">
                        <label class="custom-control-label bank-method-label" for="bankMethod{{ issuer.code }}">
                            <img src="{{ page.extensions.buckaroo.media_path }}{{ issuer.code }}.png" class="bank-method-image" width=20  alt="{{ issuer.name }}" title="{{ issuer.name }}">
                            <strong>{{ issuer.name }}</strong>
                        </label>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

    {% elseif context.paymentMethod.customFields.buckaroo_key == 'creditcards' %}
        <strong>{{ "checkout.confirmCurrentPaymentShipping"|trans }}</strong>
        {{ page.extensions.buckaroo.payment_method_name_card }}

    {% elseif context.paymentMethod.customFields.buckaroo_key == 'afterpay' %}
        <strong>{{ "checkout.confirmCurrentPaymentShipping"|trans }}</strong>
        
        {{ page.extensions.buckaroo.payment_labels[context.paymentMethod.name]?:context.paymentMethod.translated.name }}

    <div class="payment-method-second-col billing-address-form">
        <fieldset class="fieldset payment">

            <div class="form-group">
                <label class="form-label" for="buckarooAfterpayPhone">
                    {{ "bkr-checkout.buckarooAfterpayPhone"|trans|sw_sanitize }}{{ "general.required"|trans|sw_sanitize }}
                </label>

                <input type="text"
                       class="form-control{% if formViolations.getViolations('/title') %} is-invalid{% endif %}"
                       form="confirmOrderForm"
                       id="buckarooAfterpayPhone"
                       name="buckaroo_afterpay_phone"
                       placeholder="{{ "bkr-checkout.buckarooAfterpayPhonePlaceholder"|trans|striptags }}{{ "general.required"|trans|striptags }}"
                       value=""
                       required="required"
                       minlength="10">
            </div>

            <div class="form-group">
                <label class="label" for="buckaroo_afterpay_DoB">{{ "bkr-checkout.buckarooAfterpayDoBTitle"|trans }}:</label>
                <span><sup>{{ "bkr-checkout.buckarooAfterpayDoBTitleSup"|trans }}</sup></span>
                <div class="control">
                    <input id="buckaroo_afterpay_DoB" 
                    class="form-control field" 
                    type="date"
                    max='{{ "now"|date_modify("-18 years")|date("Y-m-d") }}'
                    name="buckaroo_afterpay_DoB"
                    form="confirmOrderForm"
                    required="required"
                    >
                </div>
            </div>

            <div class="custom-control custom-checkbox">
                <input id="buckaroo_afterpay_TermsCondition" class="custom-control-input" form="confirmOrderForm" name="buckaroo_afterpay_TermsCondition" required="required" type="checkbox">
                <label class="custom-control-label" for="buckaroo_afterpay_TermsCondition"> <span>{{ "bkr-checkout.buckarooAfterpayTermsConditionTitle"|trans }}:</span> </label>
                <span>
                    <a target="_blank" href="https://documents.myafterpay.com/consumer-terms-conditions/nl_nl/">{{ "bkr-checkout.buckarooAfterpayTermsCondition"|trans }}</a>
                </span>
            </div>

        </fieldset>
    </div>

    {% elseif context.paymentMethod.customFields.buckaroo_key == 'giropay' %}
        <strong>{{ "checkout.confirmCurrentPaymentShipping"|trans }}</strong>
        
        {{ page.extensions.buckaroo.payment_labels[context.paymentMethod.name]?:context.paymentMethod.translated.name }}

    <div class="payment-method-second-col billing-address-form">
        <fieldset class="fieldset payment">

            <div class="form-group">
                <label class="form-label" for="buckarooGiropayBic">
                    {{ "bkr-checkout.buckarooGiropayBic"|trans|sw_sanitize }}{{ "general.required"|trans|sw_sanitize }}
                </label>

                <input type="text"
                       class="form-control"
                       form="confirmOrderForm"
                       id="buckarooGiropayBic"
                       name="buckarooGiropayBic"
                       pattern="([a-zA-Z]{4})([a-zA-Z]{2})(([2-9a-zA-Z]{1})([0-9a-np-zA-NP-Z]{1}))((([0-9a-wy-zA-WY-Z]{1})([0-9a-zA-Z]{2}))|([xX]{3})|)"
                       placeholder="{{ "bkr-checkout.buckarooGiropayBicPlaceholder"|trans|striptags }}{{ "general.required"|trans|striptags }}"
                       required="required">
            </div>
        </fieldset>
    </div>

    {% elseif context.paymentMethod.customFields.buckaroo_key == 'sepadirectdebit' %}
        <strong>{{ "checkout.confirmCurrentPaymentShipping"|trans }}</strong>
        
        {{ page.extensions.buckaroo.payment_labels[context.paymentMethod.name]?:context.paymentMethod.translated.name }}

            <div class="payment-method-second-col billing-address-form">
                <fieldset class="fieldset payment">

                <div class="form-group">
                    <label class="form-label" for="buckarooSepaDirectDebitCustomer">
                        {{ "bkr-checkout.buckarooSepaDirectDebitCustomer"|trans|sw_sanitize }}{{ "general.required"|trans|sw_sanitize }}
                    </label>

                    <input type="text"
                           class="form-control"
                           form="confirmOrderForm"
                           id="buckarooSepaDirectDebitCustomer"
                           name="buckarooSepaDirectDebitCustomer"
                           placeholder="{{ "bkr-checkout.buckarooSepaDirectDebitCustomerholder"|trans|striptags }}{{ "general.required"|trans|striptags }}"
                           required="required"
                           minlength="2">
                </div>

                <div class="form-group">
                    <label class="form-label" for="buckarooSepaDirectDebitIBAN">
                        {{ "bkr-checkout.buckarooIBAN"|trans|sw_sanitize }}{{ "general.required"|trans|sw_sanitize }}
                    </label>

                    <input type="text"
                           class="form-control"
                           form="confirmOrderForm"
                           id="buckarooSepaDirectDebitIBAN"
                           name="buckarooSepaDirectDebitIBAN"
                           pattern="^([A-Z]{2}[ \-]?[0-9]{2})(?=(?:[ \-]?[A-Z0-9]){9,30}$)((?:[ \-]?[A-Z0-9]{3,5}){2,7})([ \-]?[A-Z0-9]{1,3})?$"
                           placeholder="{{ "bkr-checkout.buckarooIBANPlaceholder"|trans|striptags }}{{ "general.required"|trans|striptags }}"
                           required="required">
                </div>
            </fieldset>
        </div>

    {% else %}
        <strong>{{ "checkout.confirmCurrentPaymentShipping"|trans|sw_sanitize }}</strong>
        {{ page.extensions.buckaroo.payment_labels[context.paymentMethod.name]?:context.paymentMethod.translated.name }}
    {% endif %}
    
{% endblock %}

{% block page_checkout_confirm_payment_form_fields %}
    {% sw_include '@Storefront/storefront/component/payment/payment-fields.html.twig' with {
        'defaultPaymentMethodId': context.paymentMethod.id,
        'payment_labels': page.extensions.buckaroo.payment_labels,
    } %}
{% endblock %}